<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>PvP</title>

<style>
body{
 background:#0b0b0b;
 color:#fff;
 font-family:Arial,Helvetica,sans-serif;
 margin:0;
 padding:15px;
}
.box{
 background:#151515;
 border-radius:10px;
 padding:15px;
}
button{
 width:100%;
 padding:12px;
 margin-top:8px;
 border:none;
 border-radius:8px;
 background:#222;
 color:#fff;
 font-size:16px;
}
button:hover{background:#333}
img{max-width:100%;border-radius:8px;margin:10px 0}
.result{text-align:center;font-size:18px}
</style>
</head>

<body>

<div class="box">
 <h2>‚öîÔ∏è PvP</h2>
 <div id="content">Y√ºkleniyor...</div>
</div>

<button onclick="history.back()">‚¨Ö Geri</button>

<!-- 1Ô∏è‚É£ SUPABASE SCRIPT (EN √ñNEMLƒ∞ SATIR) -->
<script src="https://unpkg.com/@supabase/supabase-js@2"></script>

<!-- 2Ô∏è‚É£ PvP SCRIPT -->
<script>
console.log("PvP JS ba≈üladƒ±");

// AYARLAR
const SUPABASE_URL = "https://hwhscuyudwphnsipibpy.supabase.co";
const SUPABASE_KEY = "sb_publishable_dItLcV8z83CvDWuR8nTabA_ImTHGETu";
const TELEGRAM_ID = "162154220";

// CLIENT
const sb = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);
console.log("Supabase hazƒ±r");

// PvP y√ºkle
async function loadPvP(){
 const { data, error } = await sb
  .from("pvp_questions")
  .select("*")
  .eq("active", true)
  .limit(1)
  .single();

 if(error){
  document.getElementById("content").innerHTML =
   "<div class='result'>‚ùå Soru bulunamadƒ±</div>";
  console.error(error);
  return;
 }

 window.startTime = Date.now();

 document.getElementById("content").innerHTML = `
  ${data.image_url ? `<img src="${data.image_url}">` : ``}
  <p><b>${data.question}</b></p>
  <button onclick="answer(${data.id},'A')">A) ${data.option_a}</button>
  <button onclick="answer(${data.id},'B')">B) ${data.option_b}</button>
  <button onclick="answer(${data.id},'C')">C) ${data.option_c}</button>
  <button onclick="answer(${data.id},'D')">D) ${data.option_d}</button>
 `;
}

// Cevapla
async function answer(id, choice){
 const time = Math.floor((Date.now() - window.startTime)/1000);

 const { data, error } = await sb.rpc("pvp_answer",{
  p_telegram_id: TELEGRAM_ID,
  p_question_id: id,
  p_answer: choice,
  p_time: time
 });

 if(error){
  document.getElementById("content").innerHTML =
   "<div class='result'>‚ùå Sunucu hatasƒ±</div>";
  console.error(error);
  return;
 }

 document.getElementById("content").innerHTML =
  data.result === "win"
   ? `<div class="result">üèÜ Kazandƒ±n<br>+${data.xp} XP<br>+${data.yton} YTon</div>`
   : `<div class="result">‚ùå Kaybettin<br>${data.yton} YTon</div>`;
}

// BA≈ûLAT
loadPvP();
</script>

</body>
</html>
