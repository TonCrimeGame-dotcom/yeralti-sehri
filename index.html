<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<title>YeraltÄ± Åehri</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script src="https://unpkg.com/@supabase/supabase-js@2"></script>

<style>
body{background:#0b0b0b;color:#fff;font-family:Arial,sans-serif;padding:20px}
h1{text-align:center}
button{width:100%;padding:14px;margin:8px 0;background:#1a1a1a;color:#fff;border:none;border-radius:8px;font-size:16px}
button:hover{background:#333}
.box{background:#151515;padding:15px;border-radius:8px;margin-bottom:15px}
.hidden{display:none}
.success{color:#4caf50}
.error{color:#f44336}
small{color:#aaa}
</style>
</head>

<body>

<h1>ğŸ”¥ YeraltÄ± Åehri</h1>

<div id="playerInfo" class="box">YÃ¼kleniyor...</div>

<button onclick="showBox('missions')">ğŸ’£ GÃ¶revler</button>
<button onclick="showBox('shop')">ğŸ›’ SatÄ±n AlÄ±m</button>
<button onclick="hospital()">ğŸ¥ Hastane</button>
<button onclick="openNightlife()">ğŸŒƒ Gece HayatÄ±</button>
<button onclick="openWeapons()">ğŸ”« Silah KaÃ§akÃ§Ä±sÄ±</button>

<div id="missions" class="box hidden"></div>
<div id="shop" class="box hidden"></div>
<div id="nightlife" class="box hidden"></div>
<div id="weapons" class="box hidden"></div>
<div id="result" class="box hidden"></div>

<script>
/* ================= SUPABASE ================= */
const sb = supabase.createClient(
  "https://hwhscuyudwphnsipibpy.supabase.co",
  "sb_publishable_dItLcV8z83CvDWuR8nTabA_ImTHGETu"
);
const TELEGRAM_ID = "162154220";

/* ================= GECE KULÃœBÃœ ALKOLLER ================= */
const clubDrinks = [
  {id:101,name:"Bira",price:10,effect:"+5 Enerji"},
  {id:102,name:"Åarap",price:15,effect:"+8 Enerji"},
  {id:103,name:"Votka",price:20,effect:"+10 Enerji"},
  {id:104,name:"Viski",price:25,effect:"+12 Enerji"},
  {id:105,name:"Tekila",price:22,effect:"+10 Enerji"},
  {id:106,name:"Cin",price:18,effect:"+7 Enerji"},
  {id:107,name:"Rom",price:20,effect:"+9 Enerji"},
  {id:108,name:"Åampanya",price:30,effect:"+5 Enerji + Prestij"},
  {id:109,name:"LikÃ¶r",price:16,effect:"+6 Enerji"},
  {id:110,name:"Absinthe",price:40,effect:"+15 Enerji (Risk â†‘)"},
  {id:111,name:"Martini",price:22,effect:"+8 Enerji"},
  {id:112,name:"Mojito",price:18,effect:"+6 Enerji"},
  {id:113,name:"Bloody Mary",price:24,effect:"+9 Enerji"},
  {id:114,name:"Whiskey Sour",price:26,effect:"+10 Enerji"},
  {id:115,name:"Negroni",price:28,effect:"+10 Enerji (Risk â†‘)"},
  {id:116,name:"Long Island",price:35,effect:"+18 Enerji (Risk â†‘â†‘)"},
  {id:117,name:"Sake",price:27,effect:"+9 Enerji"},
  {id:118,name:"Brandy",price:23,effect:"+8 Enerji"},
  {id:119,name:"Cognac",price:32,effect:"+11 Enerji"},
  {id:120,name:"RakÄ±",price:25,effect:"+10 Enerji (Risk â†‘)"}
];

/* ================= COFFEE SHOP UYUÅTURUCULAR ================= */
const drugs = [
  {id:201,name:"Ot",price:30,effect:"+5 XP"},
  {id:202,name:"Mantar",price:40,effect:"+8 XP (Risk â†‘)"},
  {id:203,name:"Ã‡izik",price:35,effect:"+6 XP"},
  {id:204,name:"Pembe Toz",price:50,effect:"+12 XP (Risk â†‘)"},
  {id:205,name:"Beyaz TaÅŸ",price:55,effect:"+14 XP (Risk â†‘â†‘)"},
  {id:206,name:"Siyah Kristal",price:60,effect:"+15 XP (Risk â†‘â†‘)"},
  {id:207,name:"SarÄ± Hap",price:45,effect:"+10 XP"},
  {id:208,name:"Mavi Hap",price:48,effect:"+11 XP"},
  {id:209,name:"Asit",price:70,effect:"+18 XP (Risk â†‘â†‘)"},
  {id:210,name:"Bonzai",price:25,effect:"+4 XP (Risk â†‘)"},
  {id:211,name:"KÄ±rmÄ±zÄ± Åeker",price:38,effect:"+7 XP"},
  {id:212,name:"YeÅŸil Ã‡amur",price:42,effect:"+9 XP"},
  {id:213,name:"Gece Tozu",price:65,effect:"+16 XP (Risk â†‘â†‘)"},
  {id:214,name:"Sokak KarÄ±ÅŸÄ±mÄ±",price:33,effect:"+6 XP"},
  {id:215,name:"Mor Sis",price:58,effect:"+13 XP"},
  {id:216,name:"Beyin YakÄ±cÄ±",price:75,effect:"+20 XP (Risk â†‘â†‘â†‘)"},
  {id:217,name:"Ã‡akma MD",price:46,effect:"+10 XP"},
  {id:218,name:"Kafa AÃ§an",price:52,effect:"+12 XP"},
  {id:219,name:"HÄ±zlandÄ±rÄ±cÄ±",price:60,effect:"+14 XP"},
  {id:220,name:"YeraltÄ± Ã–zel",price:80,effect:"+22 XP (Risk â†‘â†‘â†‘)"}
];

/* ================= UI ================= */
function showBox(id){
  document.querySelectorAll(".box").forEach(b=>b.classList.add("hidden"));
  document.getElementById(id).classList.remove("hidden");
}
function showResult(msg,isErr=false){
  showBox("result");
  document.getElementById("result").innerHTML =
    `<span class="${isErr?'error':'success'}">${msg}</span>`;
}

/* ================= PLAYER ================= */
async function loadPlayer(){
  const { data } = await sb.from("players")
    .select("*")
    .eq("telegram_id", TELEGRAM_ID)
    .single();
  if(!data){ document.getElementById("playerInfo").innerHTML="Oyuncu yok"; return; }
  document.getElementById("playerInfo").innerHTML = `
    <b>Karakter:</b> ${data.character}<br>
    <b>Level:</b> ${data.level}<br>
    <b>XP:</b> ${data.xp}<br>
    <b>Enerji:</b> ${data.energy}<br>
    <b>YTon:</b> ${data.yton}
  `;
}

/* ================= GECE HAYATI ================= */
function openNightlife(){
  showBox("nightlife");
  document.getElementById("nightlife").innerHTML=`
    <b>ğŸŒƒ Gece HayatÄ±</b>
    <button onclick="openClub()">ğŸ¸ Gece KulÃ¼bÃ¼</button>
    <button onclick="openCoffee()">â˜• Coffee Shop</button>
    <button onclick="openBrothel()">ğŸ’‹ Genel Ev</button>
  `;
}

function openClub(){
  showBox("nightlife");
  let html=`<b>ğŸ¸ Gece KulÃ¼bÃ¼</b><br><br>`;
  clubDrinks.forEach(d=>{
    html+=`<button onclick="buy(${d.id})">${d.name} â€“ ${d.price} YTon<br><small>${d.effect}</small></button>`;
  });
  html+=`<button onclick="openNightlife()">â¬… Geri</button>`;
  document.getElementById("nightlife").innerHTML=html;
}

function openCoffee(){
  showBox("nightlife");
  let html=`<b>â˜• Coffee Shop</b><br><br>`;
  drugs.forEach(d=>{
    html+=`<button onclick="buy(${d.id})">${d.name} â€“ ${d.price} YTon<br><small>${d.effect}</small></button>`;
  });
  html+=`<button onclick="openNightlife()">â¬… Geri</button>`;
  document.getElementById("nightlife").innerHTML=html;
}

function openBrothel(){
  showBox("nightlife");
  document.getElementById("nightlife").innerHTML=`
    <b>ğŸ’‹ Genel Ev</b>
    <button onclick="hospital()">â¤ï¸ Hizmet Al â€“ 25</button>
    <button onclick="openNightlife()">â¬… Geri</button>
  `;
}

/* ================= SATIN ALIM / HASTANE ================= */
async function buy(id){
  const { data } = await sb.rpc("buy_item",{p_telegram_id: TELEGRAM_ID,p_item_id: id});
  showResult(data?.error ?? "SatÄ±n alÄ±ndÄ±", !!data?.error);
  loadPlayer();
}
async function hospital(){
  const { data } = await sb.rpc("hospital_heal",{p_telegram_id: TELEGRAM_ID});
  showResult(data?.error ?? "Ä°yileÅŸtirildin", !!data?.error);
  loadPlayer();
}

/* ================= SÄ°LAH KAÃ‡AKÃ‡ISI ================= */
function openWeapons(){
  showBox("weapons");
  document.getElementById("weapons").innerHTML=`
    <b>ğŸ”« Silah KaÃ§akÃ§Ä±sÄ±</b>
    <button onclick="buy(31)">ğŸ”« Tabanca â€“ 50</button>
    <button onclick="buy(32)">ğŸ’£ BÄ±Ã§ak â€“ 20</button>
  `;
}

/* ================= INIT ================= */
loadPlayer();
</script>

</body>
</html>
