<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<title>Yeraltƒ± ≈ûehri</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<script src="https://unpkg.com/@supabase/supabase-js@2"></script>

<style>
body{background:#0b0b0b;color:#fff;font-family:Arial;padding:20px}
h1{text-align:center}
button{width:100%;padding:14px;margin:8px 0;background:#1a1a1a;color:#fff;border:none;border-radius:8px;font-size:16px}
button:hover{background:#333}
.box{background:#151515;padding:15px;border-radius:8px;margin-bottom:15px}
.hidden{display:none}
.success{color:#4caf50}
.error{color:#f44336}
small{color:#aaa}
</style>
</head>

<body>

<h1>üî• Yeraltƒ± ≈ûehri</h1>

<div id="playerInfo" class="box">Y√ºkleniyor...</div>

<button onclick="loadMissions()">üí£ G√∂revler</button>
<button onclick="loadShop()">üõí Market</button>
<button onclick="hospital()">üè• Hastane</button>
<button onclick="openNightlife()">üåÉ Gece Hayatƒ±</button>
<button onclick="openWeapons()">üî´ Silah Ka√ßak√ßƒ±sƒ±</button>

<div id="missions" class="box hidden"></div>
<div id="shop" class="box hidden"></div>
<div id="nightlife" class="box hidden"></div>
<div id="weapons" class="box hidden"></div>
<div id="result" class="box hidden"></div>

<script>
/* ================= SUPABASE ================= */
const sb = supabase.createClient(
  "https://hwhscuyudwphnsipibpy.supabase.co",
  "sb_publishable_dItLcV8z83CvDWuR8nTabA_ImTHGETu"
);
const TELEGRAM_ID = "162154220";

/* ================= UI ================= */
function showBox(id){
  document.querySelectorAll(".box").forEach(b=>b.classList.add("hidden"));
  document.getElementById(id).classList.remove("hidden");
}
function showResult(msg,err=false){
  showBox("result");
  document.getElementById("result").innerHTML =
    `<span class="${err?'error':'success'}">${msg}</span>`;
}

/* ================= PLAYER ================= */
async function loadPlayer(){
  const { data } = await sb.from("players")
    .select("*")
    .eq("telegram_id", TELEGRAM_ID)
    .single();
  if(!data) return;
  document.getElementById("playerInfo").innerHTML = `
    <b>Enerji:</b> ${data.energy} |
    <b>YTon:</b> ${data.yton}
  `;
}

/* ================= GECE HAYATI ================= */
function openNightlife(){
  showBox("nightlife");
  document.getElementById("nightlife").innerHTML=`
    <b>üåÉ Gece Hayatƒ±</b>
    <button onclick="openBrothel()">üíã Genel Ev</button>
  `;
}

/* ================= GENEL EV ‚Äì ƒ∞Sƒ∞MLƒ∞ ================= */
const brothel = [
  /* 35 Kadƒ±n */
  {id:501,name:"Mia Khalite",price:30},
  {id:502,name:"Lana Rhoadsen",price:31},
  {id:503,name:"Abella Dangez",price:32},
  {id:504,name:"Riley Reedon",price:33},
  {id:505,name:"Sasha Greyon",price:34},
  {id:506,name:"Brandi Luvex",price:35},
  {id:507,name:"Angela Whitey",price:36},
  {id:508,name:"Eva Elphine",price:37},
  {id:509,name:"Megan Raines",price:38},
  {id:510,name:"Jenna Jamis",price:39},
  {id:511,name:"Alexis Tex",price:40},
  {id:512,name:"Adriana Chex",price:41},
  {id:513,name:"Nina Northy",price:42},
  {id:514,name:"Kendra Lusty",price:43},
  {id:515,name:"Scarlett Bloom",price:44},
  {id:516,name:"Olivia Blackx",price:45},
  {id:517,name:"Violet Myres",price:46},
  {id:518,name:"Bella Storm",price:47},
  {id:519,name:"Daisy Cruz",price:48},
  {id:520,name:"Ruby Knox",price:49},
  {id:521,name:"Jade Lux",price:50},
  {id:522,name:"Tiffany Rose",price:51},
  {id:523,name:"Lexi Moon",price:52},
  {id:524,name:"Nora Fox",price:53},
  {id:525,name:"Amber Sky",price:54},
  {id:526,name:"Kylie Snow",price:55},
  {id:527,name:"Naomi Silk",price:56},
  {id:528,name:"Vanessa Heat",price:57},
  {id:529,name:"Crystal Ray",price:58},
  {id:530,name:"Lola Vice",price:59},
  {id:531,name:"Monica Blaze",price:60},
  {id:532,name:"Sienna Gold",price:61},
  {id:533,name:"Roxy Flame",price:62},
  {id:534,name:"Paige Noir",price:63},
  {id:535,name:"Ivy Storme",price:64},

  /* 10 Erkek */
  {id:601,name:"Johnny Sinsor",price:40},
  {id:602,name:"Manuel Ferron",price:41},
  {id:603,name:"James Deenor",price:42},
  {id:604,name:"Rocco Steely",price:43},
  {id:605,name:"Markus Dupreez",price:44},
  {id:606,name:"Alex Legend",price:45},
  {id:607,name:"Tony Blade",price:46},
  {id:608,name:"Victor Stone",price:47},
  {id:609,name:"Leo Strong",price:48},
  {id:610,name:"Max Power",price:49},

  /* 5 ƒ∞kiz */
  {id:701,name:"Luna & Nova",price:70},
  {id:702,name:"Bella & Stella",price:75},
  {id:703,name:"Ruby & Rose",price:80},
  {id:704,name:"Maya & Mila",price:85},
  {id:705,name:"Lexi & Leni",price:90}
];

function openBrothel(){
  showBox("nightlife");
  let html="<b>üíã Genel Ev</b><br><small>Kadƒ±n / Erkek / ƒ∞kiz</small><br>";
  brothel.forEach(p=>{
    html+=`<button onclick="buy(${p.id})">${p.name} ‚Äì ${p.price} YTon</button>`;
  });
  html+=`<button onclick="openNightlife()">‚¨Ö Geri</button>`;
  document.getElementById("nightlife").innerHTML=html;
}

/* ================= BUY ================= */
async function buy(id){
  const { data } = await sb.rpc("buy_item",{p_telegram_id:TELEGRAM_ID,p_item_id:id});
  showResult(data?.error ?? "Satƒ±n alƒ±ndƒ±",!!data?.error);
  loadPlayer();
}

/* ================= HASTANE ================= */
async function hospital(){
  const { data } = await sb.rpc("hospital_heal",{p_telegram_id:TELEGRAM_ID});
  showResult(data?.error ?? "ƒ∞yile≈ütirildin",!!data?.error);
  loadPlayer();
}

/* ================= INIT ================= */
loadPlayer();
</script>

</body>
</html>
