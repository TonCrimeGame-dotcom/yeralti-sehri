<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<title>YeraltÄ± Demo +19</title>
<style>
body {
  background:#0b0b0b;
  color:#eee;
  font-family:Arial, sans-serif;
}
h2 { margin-top:20px; }
button {
  background:#222;
  color:#fff;
  border:1px solid #444;
  padding:10px;
  margin:5px;
  cursor:pointer;
}
button:hover { background:#444; }
#menu button { width:180px; display:block; }
.card {
  border:1px solid #333;
  padding:10px;
  margin:10px 0;
  border-radius:6px;
  background:#151515;
}
#log {
  margin-top:15px;
  padding:12px;
  background:#111;
  border-radius:6px;
  color:#4caf50;
  font-weight:bold;
}
.hidden { display:none; }
</style>
</head>

<body>

<h1>ğŸŒ’ YeraltÄ± Åehri (+19)</h1>

<div>
  XP: <span id="xp">0</span> |
  yTon: <span id="money">100</span> |
  Enerji: <span id="energy">100</span>
</div>

<hr>

<div id="menu"></div>

<div id="content"></div>

<div id="log"></div>

<script>
let player = {
  xp: 0,
  money: 100,
  energy: 100
};

const menuItems = [
  { name:"GÃ¶rev Yap ğŸ’£", id:"mission" },
  { name:"Ekipman PazarÄ± ğŸ”«", id:"weapons" },
  { name:"YeraltÄ± Market ğŸ§ª", id:"drugs" },
  { name:"Gece KulÃ¼bÃ¼ ğŸ¸", id:"club" }
];

const weapons = [
  { name:"KaraYel V3", power:65, price:120 },
  { name:"GeceIsÄ±rÄ±ÄŸÄ±-X", power:82, price:220 },
  { name:"SokakAzmanÄ±", power:95, price:350 }
];

const drugs = [
  { name:"Mavi Sis", effect:"+15 Enerji / -5 SaÄŸlÄ±k", price:40 },
  { name:"KÄ±zÄ±l Toz", effect:"+25 Enerji / -10 SaÄŸlÄ±k", price:70 },
  { name:"Gece DamlasÄ±", effect:"+40 Enerji / -20 SaÄŸlÄ±k", price:120 }
];

const drinks = [
  { name:"KaranlÄ±k Viski", energy:+10, price:30 },
  { name:"Neon Vodka", energy:+15, price:45 },
  { name:"YeraltÄ± Kokteyli", energy:+25, price:70 }
];

const menuDiv = document.getElementById("menu");
const content = document.getElementById("content");
const log = document.getElementById("log");

menuItems.forEach(item => {
  const btn = document.createElement("button");
  btn.innerText = item.name;
  btn.onclick = () => openSection(item.id);
  menuDiv.appendChild(btn);
});

function updateStats() {
  xp.innerText = player.xp;
  money.innerText = player.money;
  energy.innerText = player.energy;
}

function message(text) {
  log.innerText = text;
}

function openSection(id) {
  content.innerHTML = "";
  log.innerText = "";

  if (id === "mission") {
    const btn = document.createElement("button");
    btn.innerText = "GÃ¶revi Bas";
    btn.onclick = () => {
      player.xp += 30;
      player.money += 50;
      player.energy -= 10;
      updateStats();
      message("Ä°ÅŸ tamam ğŸ˜ +30 XP aldÄ±n, 50 yTon cebe ğŸ’¸, 10 enerji yandÄ± âš¡");
    };
    content.appendChild(btn);
  }

  if (id === "weapons") {
    weapons.forEach(w => {
      const c = document.createElement("div");
      c.className = "card";
      c.innerHTML = `<b>${w.name}</b><br>GÃ¼Ã§: ${w.power}<br>Fiyat: ${w.price} yTon`;
      const b = document.createElement("button");
      b.innerText = "SatÄ±n Al";
      b.onclick = () => buy(w.price, `Silah alÄ±ndÄ± ğŸ”« ${w.name}`);
      c.appendChild(b);
      content.appendChild(c);
    });
  }

  if (id === "drugs") {
    drugs.forEach(d => {
      const c = document.createElement("div");
      c.className = "card";
      c.innerHTML = `<b>${d.name}</b><br>Etki: ${d.effect}<br>Fiyat: ${d.price} yTon`;
      const b = document.createElement("button");
      b.innerText = "Kullan";
      b.onclick = () => {
        buy(d.price, `${d.name} kullandÄ±n ğŸ§ª Kafa gÃ¼zel ama risk varâ€¦`);
        player.energy += 15;
        updateStats();
      };
      c.appendChild(b);
      content.appendChild(c);
    });
  }

  if (id === "club") {
    drinks.forEach(dr => {
      const c = document.createElement("div");
      c.className = "card";
      c.innerHTML = `<b>${dr.name}</b><br>Enerji +${dr.energy}<br>Fiyat: ${dr.price} yTon`;
      const b = document.createElement("button");
      b.innerText = "Ä°Ã§";
      b.onclick = () => {
        buy(dr.price, `${dr.name} aktÄ± ğŸ¸ Enerji yÃ¼kseldi`);
        player.energy += dr.energy;
        updateStats();
      };
      c.appendChild(b);
      content.appendChild(c);
    });
  }
}

function buy(price, text) {
  if (player.money < price) {
    message("Para yetmedi ğŸ˜¤");
    return;
  }
  player.money -= price;
  updateStats();
  message(text);
}

updateStats();
</script>

</body>
</html>
  const { data } = await sb.from("missions").select("*").eq("active", true);

  if(!data || data.length===0){
    box.innerHTML += "<div>GÃ¶rev yok</div>";
    return;
  }

  data.forEach(m=>{
    box.innerHTML += `
      <button onclick="doMission(${m.id})">
        ${m.name}<br>
        Enerji: ${m.energy_cost} | Ã–dÃ¼l: ${m.yton_reward}
      </button>`;
  });
}

async function doMission(id){
  hideAll();
  const r = document.getElementById("result");
  r.classList.remove("hidden");
  r.innerHTML = "GÃ¶rev yapÄ±lÄ±yor...";

  const { data } = await sb.rpc("do_mission",{
    p_telegram_id: TELEGRAM_ID,
    p_mission_id: id
  });

  r.innerHTML = data?.error
    ? `<div class="error">${data.error}</div>`
    : `<div class="success">GÃ¶rev baÅŸarÄ±lÄ±</div>`;

  loadPlayer();
}

/* ===== SHOP ===== */
function loadShop(){
  hideAll();
  const box = document.getElementById("shop");
  box.classList.remove("hidden");
  box.innerHTML = `
    <h3>SatÄ±n AlÄ±m</h3>
    <button onclick="buyItem(1)">ğŸ”« Tabanca â€“ 50</button>
    <button onclick="buyItem(2)">ğŸº Alkol â€“ 10</button>
    <button onclick="buyItem(3)">ğŸ’Š UyuÅŸturucu â€“ 30</button>
  `;
}

async function buyItem(id){
  hideAll();
  const r = document.getElementById("result");
  r.classList.remove("hidden");

  const { data } = await sb.rpc("buy_item",{
    p_telegram_id: TELEGRAM_ID,
    p_item_id: id
  });

  r.innerHTML = data?.error
    ? `<div class="error">${data.error}</div>`
    : `<div class="success">SatÄ±n alÄ±ndÄ±</div>`;

  loadPlayer();
}

/* ===== HOSPITAL ===== */
async function hospital(){
  hideAll();
  const r = document.getElementById("result");
  r.classList.remove("hidden");

  const { data } = await sb.rpc("hospital_heal",{ p_telegram_id: TELEGRAM_ID });

  r.innerHTML = data?.error
    ? `<div class="error">${data.error}</div>`
    : `<div class="success">Ä°yileÅŸtirildin</div>`;

  loadPlayer();
}

/* ===== INIT ===== */
loadPlayer();
</script>

</body>
</html>
