<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<title>YeraltÄ± Åehri</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<script src="https://unpkg.com/@supabase/supabase-js@2"></script>

<style>
body{background:#0b0b0b;color:#fff;font-family:Arial;padding:20px}
h1{text-align:center}
.box{background:#151515;padding:15px;border-radius:8px;margin-bottom:15px}
button{width:100%;padding:14px;margin:6px 0;background:#1e1e1e;color:#fff;border:none;border-radius:6px;font-size:16px}
button:hover{background:#333}
.hidden{display:none}
.success{color:#4caf50}
.error{color:#f44336}
</style>
</head>

<body>

<h1>ğŸ”¥ YeraltÄ± Åehri</h1>

<div class="box" id="playerInfo">YÃ¼kleniyor...</div>

<button onclick="show('missions')">ğŸ’£ GÃ¶revler</button>
<button onclick="show('shop')">ğŸ›’ SatÄ±n AlÄ±m</button>
<button onclick="show('hospital')">ğŸ¥ Hastane</button>
<button onclick="show('nightlife')">ğŸŒƒ Gece HayatÄ±</button>
<button onclick="show('weapons')">ğŸ”« Silah KaÃ§akÃ§Ä±sÄ±</button>

<div id="missions" class="box hidden"></div>
<div id="shop" class="box hidden"></div>
<div id="hospital" class="box hidden"></div>
<div id="nightlife" class="box hidden"></div>
<div id="weapons" class="box hidden"></div>
<div id="result" class="box hidden"></div>

<script>
const supabase = supabase.createClient(
  "https://hwhscuyudwphnsipibpy.supabase.co",
  "sb_publishable_dItLcV8z83CvDWuR8nTabA_ImTHGETu"
);

const TELEGRAM_ID = "162154220";

function show(id){
  document.querySelectorAll(".box").forEach(b=>b.classList.add("hidden"));
  document.getElementById(id).classList.remove("hidden");
}

async function loadPlayer(){
  const {data} = await supabase
    .from("players")
    .select("*")
    .eq("telegram_id",TELEGRAM_ID)
    .single();

  document.getElementById("playerInfo").innerHTML=`
  <b>Karakter:</b> ${data.character}<br>
  <b>Level:</b> ${data.level}<br>
  <b>XP:</b> ${data.xp}<br>
  <b>Enerji:</b> ${data.energy}<br>
  <b>YTon:</b> ${data.yton}`;
}

async function loadMissions(){
  const {data}=await supabase.from("missions").select("*").eq("active",true);
  let html="<h3>GÃ¶revler</h3>";
  data.forEach(m=>{
    html+=`<button onclick="doMission(${m.id})">${m.name} | Risk %${m.risk_percent}</button>`;
  });
  document.getElementById("missions").innerHTML=html;
}

async function doMission(id){
  const {data}=await supabase.rpc("do_mission",{p_telegram_id:TELEGRAM_ID,p_mission_id:id});
  show("result");
  document.getElementById("result").innerHTML=
    data?.error ? `<span class="error">${data.error}</span>` :
    `<span class="success">GÃ¶rev tamamlandÄ±</span>`;
  loadPlayer();
}

async function buy(id){
  const {data}=await supabase.rpc("buy_item",{p_telegram_id:TELEGRAM_ID,p_item_id:id});
  show("result");
  document.getElementById("result").innerHTML=
    data?.error ? `<span class="error">${data.error}</span>` :
    `<span class="success">SatÄ±n alÄ±ndÄ±</span>`;
  loadPlayer();
}

function loadShop(){
  document.getElementById("shop").innerHTML=`
  <h3>Genel Market</h3>
  <button onclick="buy(1)">Enerji Ä°Ã§eceÄŸi</button>`;
}

function loadHospital(){
  document.getElementById("hospital").innerHTML=
    `<button onclick="heal()">Tedavi Ol</button>`;
}

async function heal(){
  const {data}=await supabase.rpc("hospital_heal",{p_telegram_id:TELEGRAM_ID});
  show("result");
  document.getElementById("result").innerHTML=
    data?.error ? `<span class="error">${data.error}</span>` :
    `<span class="success">Ä°yileÅŸtirildin</span>`;
  loadPlayer();
}

function loadNightLife(){
  document.getElementById("nightlife").innerHTML=`
  <h3>ğŸŒƒ Gece KulÃ¼bÃ¼</h3>
  <button onclick="buy(10)">Bira</button>
  <button onclick="buy(11)">Votka</button>
  <button onclick="buy(12)">Viski</button>

  <h3>â˜• Coffee Shop</h3>
  <button onclick="buy(20)">Ot</button>
  <button onclick="buy(21)">Mantar</button>
  <button onclick="buy(22)">Kimyasal</button>

  <h3>ğŸ’ƒ Pavyon</h3>
  <button disabled>YakÄ±nda</button>`;
}

function loadWeapons(){
  document.getElementById("weapons").innerHTML=`
  <h3>ğŸ”« Silah KaÃ§akÃ§Ä±sÄ±</h3>
  <button onclick="buy(30)">Tabanca</button>
  <button onclick="buy(31)">PompalÄ±</button>
  <button onclick="buy(32)">AK-47</button>`;
}

loadPlayer();
loadMissions();
loadShop();
loadHospital();
loadNightLife();
loadWeapons();
</script>

</body>
</html>
