<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<title>YeraltÄ± Åehri</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<script src="https://unpkg.com/@supabase/supabase-js@2"></script>
<style>
body{background:#0b0b0b;color:#fff;font-family:Arial;padding:20px}
h1{text-align:center}
button{width:100%;padding:14px;margin:8px 0;background:#1a1a1a;color:#fff;border:none;border-radius:8px}
button:hover{background:#333}
.box{background:#151515;padding:15px;border-radius:8px;margin-bottom:15px}
.hidden{display:none}
small{display:block;opacity:.7;margin:4px 0}
</style>
</head>

<body>

<h1>ğŸ”¥ YeraltÄ± Åehri</h1>

<div id="playerInfo" class="box">YÃ¼kleniyor...</div>

<button onclick="loadMissions()">ğŸ’£ GÃ¶revler</button>
<button onclick="loadMarket()">ğŸ›’ Market</button>
<button onclick="hospital()">ğŸ¥ Hastane</button>
<button onclick="openNightlife()">ğŸŒƒ Gece HayatÄ±</button>
<button onclick="openWeapons()">ğŸ”« Silah KaÃ§akÃ§Ä±sÄ±</button>

<div id="missions" class="box hidden"></div>
<div id="market" class="box hidden"></div>
<div id="nightlife" class="box hidden"></div>
<div id="weapons" class="box hidden"></div>
<div id="result" class="box hidden"></div>

<script>
/* ================= SUPABASE ================= */
const sb = supabase.createClient(
 "https://hwhscuyudwphnsipibpy.supabase.co",
 "sb_publishable_dItLcV8z83CvDWuR8nTabA_ImTHGETu"
);
const TELEGRAM_ID="162154220";

/* ================= UI ================= */
function showBox(id){
 document.querySelectorAll(".box").forEach(b=>b.classList.add("hidden"));
 document.getElementById(id).classList.remove("hidden");
}

/* ================= PLAYER ================= */
async function loadPlayer(){
 const {data}=await sb.from("players")
  .select("*").eq("telegram_id",TELEGRAM_ID).single();
 if(!data)return;
 document.getElementById("playerInfo").innerHTML=
 `Enerji: ${data.energy} | YTon: ${data.yton}`;
}

/* ================= BUY ================= */
async function buy(id){
 const {data}=await sb.rpc("buy_item",{
  p_telegram_id:TELEGRAM_ID,
  p_item_id:id
 });
 document.getElementById("result").innerHTML=data?.error||"SatÄ±n alÄ±ndÄ±";
 showBox("result");
 loadPlayer();
}

/* ================= GÃ–REVLER ================= */
async function loadMissions(){
 showBox("missions");
 const box=document.getElementById("missions");
 box.innerHTML="<b>ğŸ’£ GÃ¶revler</b>";

 const {data}=await sb.from("missions")
  .select("*")
  .eq("active",true);

 if(!data||data.length===0){
  box.innerHTML+="<p>Aktif gÃ¶rev yok</p>";
  return;
 }

 data.forEach(m=>{
  box.innerHTML+=`
   <button onclick="doMission(${m.id})">
    ${m.name} â€“ Enerji ${m.energy_cost}
   </button>
   <small>${m.description||"Riskli ama kazanÃ§lÄ±"}</small>
  `;
 });
}

async function doMission(id){
 const {data}=await sb.rpc("do_mission",{
  p_telegram_id:TELEGRAM_ID,
  p_mission_id:id
 });
 document.getElementById("result").innerHTML=
  data?.error||"GÃ¶rev baÅŸarÄ±yla tamamlandÄ±";
 showBox("result");
 loadPlayer();
}

/* ================= GECE HAYATI (SABÄ°T) ================= */
function openNightlife(){
 showBox("nightlife");
 document.getElementById("nightlife").innerHTML=`
 <b>ğŸŒƒ Gece HayatÄ±</b>
 <button onclick="openClub()">ğŸ¸ Gece KulÃ¼bÃ¼</button>
 <button onclick="openCoffee()">â˜• Coffee Shop</button>
 <button onclick="openBrothel()">ğŸ’‹ Genel Ev</button>`;
}

/* --- (Gece kulÃ¼bÃ¼ / coffee / genel ev kodlarÄ±n AYNEN duruyor) --- */

/* ================= SÄ°LAH KAÃ‡AKÃ‡ISI ================= */
const weapons=[
 {id:600,name:"Glock 19",price:50,info:"GÃ¶rev baÅŸarÄ± ÅŸansÄ± +3%"},
 {id:601,name:"Desert Eagle",price:80,info:"Hasar + yÃ¼ksek risk"},
 {id:602,name:"Uzi SMG",price:110,info:"Ã‡oklu gÃ¶rev bonusu"},
 {id:603,name:"AK-47",price:160,info:"Zor gÃ¶revlerde avantaj"},
 {id:604,name:"M4A1",price:190,info:"Elite gÃ¶rev bonusu"},
 {id:605,name:"PompalÄ± Shotgun",price:140,info:"YakÄ±n dÃ¶vÃ¼ÅŸ +"},
 {id:606,name:"Susturuculu Tabanca",price:90,info:"Risk -2"},
 {id:607,name:"Keskin NiÅŸancÄ± TÃ¼feÄŸi",price:220,info:"Boss gÃ¶rev bonusu"},
 {id:608,name:"BÄ±Ã§ak (Taktik)",price:30,info:"Enerji tÃ¼ketimi -1"},
 {id:609,name:"El BombasÄ±",price:120,info:"Tek kullanÄ±mlÄ±k gÃ¼Ã§"}
];

function openWeapons(){
 showBox("weapons");
 let h="<b>ğŸ”« Silah KaÃ§akÃ§Ä±sÄ±</b>";
 weapons.forEach(w=>{
  h+=`
   <button onclick="buy(${w.id})">
    ${w.name} â€“ ${w.price} YTon
   </button>
   <small>${w.info}</small>
  `;
 });
 document.getElementById("weapons").innerHTML=h;
}

/* ================= MARKET ================= */
function loadMarket(){
 showBox("market");
 document.getElementById("market").innerHTML="<b>ğŸ›’ Market</b>";
}

/* ================= HASTANE ================= */
async function hospital(){
 const {data}=await sb.rpc("hospital_heal",{
  p_telegram_id:TELEGRAM_ID
 });
 document.getElementById("result").innerHTML=
  data?.error||"Ä°yileÅŸtirildin";
 showBox("result");
 loadPlayer();
}

/* ================= INIT ================= */
loadPlayer();
</script>
</body>
</html>
